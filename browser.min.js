var kiwi=function(e){"use strict";let t=new Int32Array(1),n=new Float32Array(t.buffer);class i{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this.length=e?e.length:0}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),t=this._index,n=t+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let i=new Uint8Array(e);return i.set(this._data.subarray(t,n)),i}readVarFloat(){let e=this._index,i=this._data,r=i.length;if(e+1>r)throw new Error("Index out of bounds");let a=i[e];if(0===a)return this._index=e+1,0;if(e+4>r)throw new Error("Index out of bounds");let l=a|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24;return this._index=e+4,l=l<<23|l>>>9,t[0]=l,n[0]}readVarUint(){let e=0,t=0;do{var n=this.readByte();e|=(127&n)<<t,t+=7}while(128&n&&t<35);return e>>>0}readVarInt(){let e=0|this.readVarUint();return 1&e?~(e>>>1):e>>>1}readString(){let e="";for(;;){let t,n=this.readByte();if(n<192)t=n;else{let e=this.readByte();if(n<224)t=(31&n)<<6|63&e;else{let i=this.readByte();if(n<240)t=(15&n)<<12|(63&e)<<6|63&i;else{t=(7&n)<<18|(63&e)<<12|(63&i)<<6|63&this.readByte()}}}if(0===t)break;t<65536?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode(55296+(t>>10),56320+(1023&t)))}return e}_growBy(e){if(this.length+e>this._data.length){let t=new Uint8Array(this.length+e<<1);t.set(this._data),this._data=t}this.length+=e}writeByte(e){let t=this.length;this._growBy(1),this._data[t]=e}writeByteArray(e){this.writeVarUint(e.length);let t=this.length;this._growBy(e.length),this._data.set(e,t)}writeVarFloat(e){let i=this.length;n[0]=e;let r=t[0];if(r=r>>>23|r<<9,0==(255&r))return void this.writeByte(0);this._growBy(4);let a=this._data;a[i]=r,a[i+1]=r>>8,a[i+2]=r>>16,a[i+3]=r>>24}writeVarUint(e){do{let t=127&e;e>>>=7,this.writeByte(e?128|t:t)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeString(e){let t;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(n+1===e.length||i<55296||i>=56320)t=i;else{t=(i<<10)+e.charCodeAt(++n)+-56613888}if(0===t)throw new Error("Cannot encode a string containing the null character");t<128?this.writeByte(t):(t<2048?this.writeByte(t>>6&31|192):(t<65536?this.writeByte(t>>12&15|224):(this.writeByte(t>>18&7|240),this.writeByte(t>>12&63|128)),this.writeByte(t>>6&63|128)),this.writeByte(63&t|128))}this.writeByte(0)}}let r=["bool","byte","int","uint","float","string"],a=["ENUM","STRUCT","MESSAGE"];function l(e){let t=e instanceof i?e:new i(e),n=t.readVarUint(),l=[];for(let e=0;e<n;e++){let e=t.readString(),n=t.readByte(),i=t.readVarUint(),r=[];for(let e=0;e<i;e++){let e=t.readString(),i=t.readVarInt(),l=!!(1&t.readByte()),s=t.readVarUint();r.push({name:e,line:0,column:0,type:"ENUM"===a[n]?null:i,isArray:l,isDeprecated:!1,value:s})}l.push({name:e,line:0,column:0,kind:a[n],fields:r})}for(let e=0;e<n;e++){let t=l[e].fields;for(let e=0;e<t.length;e++){let n=t[e],i=n.type;if(null!==i&&i<0){if(~i>=r.length)throw new Error("Invalid type "+i);n.type=r[~i]}else{if(null!==i&&i>=l.length)throw new Error("Invalid type "+i);n.type=null===i?null:l[i].name}}}return{package:null,definitions:l}}function s(e){return JSON.stringify(e)}function u(e,t,n){var i=new Error(e);throw i.line=t,i.column=n,i}let h=["bool","byte","float","int","string","uint"],o=["ByteBuffer","package"],d=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,f=/^[A-Za-z_][A-Za-z0-9_]*$/,p=/^\/\/.*|\s+$/,c=/^=$/,b=/^$/,y=/^;$/,g=/^-?\d+$/,w=/^\{$/,m=/^\}$/,v=/^\[\]$/,B=/^enum$/,E=/^struct$/,U=/^message$/,S=/^package$/,k=/^\[deprecated\]$/;function A(e){let t=function(e){function t(){return e[h]}function n(e){return!!e.test(t().text)&&(h++,!0)}function i(e,i){if(!n(e)){let e=t();u("Expected "+i+" but found "+s(e.text),e.line,e.column)}}function r(){let e=t();u("Unexpected token "+s(e.text),e.line,e.column)}let a=[],l=null,h=0;for(n(S)&&(l=t().text,i(f,"identifier"),i(y,'";"'));h<e.length&&!n(b);){let e,l=[];n(B)?e="ENUM":n(E)?e="STRUCT":n(U)?e="MESSAGE":r();let h=t();for(i(f,"identifier"),i(w,'"{"');!n(m);){let r=null,a=!1,h=!1;"ENUM"!==e&&(r=t().text,i(f,"identifier"),a=n(v));let o=t();i(f,"identifier");let d=null;"STRUCT"!==e&&(i(c,'"="'),d=t(),i(g,"integer"),(0|+d.text)+""!==d.text&&u("Invalid integer "+s(d.text),d.line,d.column));let p=t();n(k)&&("MESSAGE"!==e&&u("Cannot deprecate this field",p.line,p.column),h=!0),i(y,'";"'),l.push({name:o.text,line:o.line,column:o.column,type:r,isArray:a,isDeprecated:h,value:null!==d?0|+d.text:l.length+1})}a.push({name:h.text,line:h.line,column:h.column,kind:e,fields:l})}return{package:l,definitions:a}}(function(e){let t=e.split(d),n=[],i=0,r=0;for(let e=0;e<t.length;e++){let a=t[e];1&e?p.test(a)||n.push({text:a,line:r+1,column:i+1}):""!==a&&u("Syntax error "+s(a),r+1,i+1);let l=a.split("\n");l.length>1&&(i=0),r+=l.length-1,i+=l[l.length-1].length}return n.push({text:"",line:r,column:i}),n}(e));return function(e){let t=h.slice(),n={};for(let i=0;i<e.definitions.length;i++){let r=e.definitions[i];-1!==t.indexOf(r.name)&&u("The type "+s(r.name)+" is defined twice",r.line,r.column),-1!==o.indexOf(r.name)&&u("The type name "+s(r.name)+" is reserved",r.line,r.column),t.push(r.name),n[r.name]=r}for(let n=0;n<e.definitions.length;n++){let i=e.definitions[n],r=i.fields;if("ENUM"===i.kind||0===r.length)continue;for(let e=0;e<r.length;e++){let n=r[e];-1===t.indexOf(n.type)&&u("The type "+s(n.type)+" is not defined for field "+s(n.name),n.line,n.column)}let a=[];for(let e=0;e<r.length;e++){let t=r[e];-1!==a.indexOf(t.value)&&u("The id for field "+s(t.name)+" is used twice",t.line,t.column),t.value<=0&&u("The id for field "+s(t.name)+" must be positive",t.line,t.column),t.value>r.length&&u("The id for field "+s(t.name)+" cannot be larger than "+r.length,t.line,t.column),a.push(t.value)}}let i={},r=e=>{let t=n[e];if(t&&"STRUCT"===t.kind&&(1===i[e]&&u("Recursive nesting of "+s(e)+" is not allowed",t.line,t.column),2!==i[e]&&t)){i[e]=1;let n=t.fields;for(let e=0;e<n.length;e++){let t=n[e];t.isArray||r(t.type)}i[e]=2}return!0};for(let t=0;t<e.definitions.length;t++)r(e.definitions[t].name)}(t),t}function x(e,t){let n=[],i="  ";n.push("function(bb) {"),n.push("  var result = {};"),n.push("  if (!(bb instanceof this.ByteBuffer)) {"),n.push("    bb = new this.ByteBuffer(bb);"),n.push("  }"),n.push(""),"MESSAGE"===e.kind&&(n.push("  while (true) {"),n.push("    switch (bb.readVarUint()) {"),n.push("    case 0:"),n.push("      return result;"),n.push(""),i="      ");for(let r=0;r<e.fields.length;r++){let a,l=e.fields[r];switch(l.type){case"bool":a="!!bb.readByte()";break;case"byte":a="bb.readByte()";break;case"int":a="bb.readVarInt()";break;case"uint":a="bb.readVarUint()";break;case"float":a="bb.readVarFloat()";break;case"string":a="bb.readString()";break;default:{let e=t[l.type];e?a="ENUM"===e.kind?"this["+s(e.name)+"][bb.readVarUint()]":"this["+s("decode"+e.name)+"](bb)":u("Invalid type "+s(l.type)+" for field "+s(l.name),l.line,l.column)}}"MESSAGE"===e.kind&&n.push("    case "+l.value+":"),l.isArray?l.isDeprecated?"byte"===l.type?n.push(i+"bb.readByteArray();"):(n.push(i+"var length = bb.readVarUint();"),n.push(i+"while (length-- > 0) "+a+";")):"byte"===l.type?n.push(i+"result["+s(l.name)+"] = bb.readByteArray();"):(n.push(i+"var length = bb.readVarUint();"),n.push(i+"var values = result["+s(l.name)+"] = Array(length);"),n.push(i+"for (var i = 0; i < length; i++) values[i] = "+a+";")):l.isDeprecated?n.push(i+a+";"):n.push(i+"result["+s(l.name)+"] = "+a+";"),"MESSAGE"===e.kind&&(n.push("      break;"),n.push(""))}return"MESSAGE"===e.kind?(n.push("    default:"),n.push('      throw new Error("Attempted to parse invalid message");'),n.push("    }"),n.push("  }")):n.push("  return result;"),n.push("}"),n.join("\n")}function _(e,t){let n=[];n.push("function(message, bb) {"),n.push("  var isTopLevel = !bb;"),n.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let i=0;i<e.fields.length;i++){let r,a=e.fields[i];if(!a.isDeprecated){switch(a.type){case"bool":case"byte":r="bb.writeByte(value);";break;case"int":r="bb.writeVarInt(value);";break;case"uint":r="bb.writeVarUint(value);";break;case"float":r="bb.writeVarFloat(value);";break;case"string":r="bb.writeString(value);";break;default:{let e=t[a.type];if(!e)throw new Error("Invalid type "+s(a.type)+" for field "+s(a.name));r="ENUM"===e.kind?"var encoded = this["+s(e.name)+'][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + '+s(" for enum "+s(e.name))+"); bb.writeVarUint(encoded);":"this["+s("encode"+e.name)+"](value, bb);"}}n.push(""),n.push("  var value = message["+s(a.name)+"];"),n.push("  if (value != null) {"),"MESSAGE"===e.kind&&n.push("    bb.writeVarUint("+a.value+");"),a.isArray?"byte"===a.type?n.push("    bb.writeByteArray(value);"):(n.push("    var values = value, n = values.length;"),n.push("    bb.writeVarUint(n);"),n.push("    for (var i = 0; i < n; i++) {"),n.push("      value = values[i];"),n.push("      "+r),n.push("    }")):n.push("    "+r),"STRUCT"===e.kind&&(n.push("  } else {"),n.push("    throw new Error("+s("Missing required field "+s(a.name))+");")),n.push("  }")}}return"MESSAGE"===e.kind&&n.push("  bb.writeVarUint(0);"),n.push(""),n.push("  if (isTopLevel) return bb.toUint8Array();"),n.push("}"),n.join("\n")}function V(e){let t={},n=(e=function(e){return"string"==typeof e?A(e):e instanceof Uint8Array||e instanceof i?l(e):e}(e)).package,r=[];null!==n?r.push("var "+n+" = exports || "+n+" || {}, exports;"):(r.push("var exports = exports || {};"),n="exports"),r.push(n+".ByteBuffer = "+n+'.ByteBuffer || require("kiwi-schema").ByteBuffer;');for(let n=0;n<e.definitions.length;n++){let i=e.definitions[n];t[i.name]=i}for(let i=0;i<e.definitions.length;i++){let a=e.definitions[i];switch(a.kind){case"ENUM":{let e={};for(let t=0;t<a.fields.length;t++){let n=a.fields[t];e[n.name]=n.value,e[n.value]=n.name}r.push(n+"["+s(a.name)+"] = "+JSON.stringify(e,null,2)+";");break}case"STRUCT":case"MESSAGE":r.push(""),r.push(n+"["+s("decode"+a.name)+"] = "+x(a,t)+";"),r.push(""),r.push(n+"["+s("encode"+a.name)+"] = "+_(a,t)+";");break;default:u("Invalid definition kind "+s(a.kind),a.line,a.column)}}return r.push(""),r.join("\n")}return e.compileSchema=function(e){let t={ByteBuffer:i};return new Function("exports",V(e))(t),t},e.decodeBinarySchema=l,e}({});
